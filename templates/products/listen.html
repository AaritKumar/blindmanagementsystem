{% extends 'base.html' %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
    <article aria-labelledby="product-name">
        <h1 id="product-name">{{ product.name }}</h1>
        <div id="product-description" data-text="{{ product.text_description|escapejs }}">
            {{ product.text_description|linebreaks }}
        </div>
    </article>

    <div role="toolbar" aria-label="Audio controls" class="visually-hidden">
        <p>Audio is playing.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const descriptionDiv = document.getElementById('product-description');
            const textToSpeak = descriptionDiv.getAttribute('data-text');
            
            if ('speechSynthesis' in window) {
                const synth = window.speechSynthesis;
                const utterance = new SpeechSynthesisUtterance(`You've scanned an accessible audio label. ${textToSpeak}`);
                utterance.rate = 0.8;

                setTimeout(() => {
                    synth.speak(utterance);
                }, 500);

                utterance.onend = () => {
                    window.location.href = "{% url 'scan_beacon' %}";
                };

            } else {
                console.error("Sorry, your browser does not support the Web Speech API.");
                descriptionDiv.insertAdjacentHTML('afterend', '<p>Sorry, your browser does not support audio playback.</p>');
            }
        });
    </script>
{% endblock %}

{% block head %}
<style>
    .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
</style>
{% endblock %}
